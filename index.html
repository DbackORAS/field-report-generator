<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#2d5a14">
<title>Optimum ‚Äî Daily Field Report</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.2/html2pdf.bundle.min.js"></script>
<style>
:root {
  --g900:#1a3a0a;--g800:#2d5a14;--g700:#3d6b1a;--g600:#4a7a20;--g500:#5b8c2a;--g400:#7db043;--g300:#a3cc6e;--g200:#d4e8b8;--g100:#eaf4dc;--g50:#f5faf0;
  --r600:#c0392b;--r100:#fde8e5;
  --d900:#111;--d800:#1e1e1e;--d700:#2a2a2a;--d600:#444;--d500:#666;--d400:#888;--d300:#aaa;--d200:#ccc;--d100:#e8e8e8;--d50:#f4f4f4;
  --w:#fff;
  --sh-s:0 1px 3px rgba(0,0,0,.06);--sh-m:0 4px 16px rgba(0,0,0,.08);--sh-l:0 8px 30px rgba(0,0,0,.12);
  --r:10px;--rl:14px;
}
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Outfit',sans-serif;background:var(--d50);color:var(--d800);line-height:1.5;-webkit-font-smoothing:antialiased}

.app-hdr{background:linear-gradient(135deg,var(--g800),var(--g600));color:var(--w);padding:16px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;box-shadow:var(--sh-m)}
.logo-area{display:flex;align-items:center;gap:12px}
.logo-mark{width:44px;height:44px;background:var(--w);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--g700);font-size:22px;box-shadow:0 2px 8px rgba(0,0,0,.15)}
.logo-text h1{font-size:17px;font-weight:700;letter-spacing:-.3px;line-height:1.2}
.logo-text .sub{font-size:11px;font-weight:400;opacity:.75;letter-spacing:.5px;text-transform:uppercase}
.hdr-btns{display:flex;gap:8px}
.btn{display:inline-flex;align-items:center;gap:6px;padding:10px 16px;border:none;border-radius:var(--r);font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;transition:all .15s}
.btn-w{background:var(--w);color:var(--g700)}.btn-w:hover{background:var(--g50);transform:translateY(-1px)}
.btn-g{background:rgba(255,255,255,.12);color:var(--w);border:1px solid rgba(255,255,255,.25)}.btn-g:hover{background:rgba(255,255,255,.22)}
.btn-green{background:var(--g600);color:var(--w)}.btn-green:hover{background:var(--g500)}

.ctn{max-width:860px;margin:0 auto;padding:20px 14px 90px}

/* Queue indicator */
.queue-bar{display:none;background:#f39c12;color:var(--w);text-align:center;padding:8px;font-size:12px;font-weight:600}
.queue-bar.show{display:block}
.queue-bar.sending{background:var(--g600)}
.queue-bar.error{background:var(--r600)}

.sec{background:var(--w);border-radius:var(--rl);box-shadow:var(--sh-s);margin-bottom:16px;overflow:hidden;border:1px solid var(--d100)}
.sec-h{background:var(--g700);color:var(--w);padding:13px 18px;font-size:14px;font-weight:700;letter-spacing:.3px;display:flex;align-items:center;gap:9px}
.sec-h .ic{font-size:17px}
.sec-h.red{background:var(--r600)}
.sec-b{padding:18px}

.fg{display:grid;grid-template-columns:1fr 1fr;gap:14px}
.fg .full{grid-column:1/-1}
.fi{display:flex;flex-direction:column;gap:4px}
.fi label{font-size:11px;font-weight:600;color:var(--d500);text-transform:uppercase;letter-spacing:.6px}
.fi input,.fi select,.fi textarea{font-family:inherit;font-size:14px;padding:10px 12px;border:1.5px solid var(--d200);border-radius:8px;background:var(--w);color:var(--d800);transition:border .15s,box-shadow .15s}
.fi input:focus,.fi select:focus,.fi textarea:focus{outline:none;border-color:var(--g400);box-shadow:0 0 0 3px rgba(91,140,42,.1)}
.fi select{cursor:pointer}
.fi textarea{resize:vertical;min-height:70px}

.dd-wrap{position:relative}
.dd-wrap select,.dd-wrap input.oth-in{width:100%}
.oth-tog{display:flex;align-items:center;gap:5px;margin-top:4px;cursor:pointer;user-select:none}
.oth-tog input[type=checkbox]{accent-color:var(--g500);width:15px;height:15px;cursor:pointer}
.oth-tog span{font-size:11px;color:var(--d400);font-weight:500}
.oth-in{display:none}
.dd-wrap.oth-on select{display:none}
.dd-wrap.oth-on .oth-in{display:block}

.wx-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.wx-card{background:linear-gradient(135deg,var(--g50),var(--g100));border:1.5px solid var(--g200);border-radius:var(--r);padding:14px;text-align:center}
.wx-card .wx-t{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.8px;color:var(--g600);margin-bottom:6px}
.wx-card .wx-icon{font-size:26px;margin:2px 0}
.wx-card .wx-temp{font-size:34px;font-weight:800;color:var(--g800);line-height:1}
.wx-card .wx-temp span{font-size:16px;font-weight:600}
.wx-card .wx-cond{font-size:13px;font-weight:600;color:var(--g600);margin:4px 0}
.wx-card .wx-det{display:flex;justify-content:center;gap:8px;font-size:10px;color:var(--d400);margin-top:6px}
.wx-status{text-align:center;padding:20px;color:var(--d400);font-size:14px}
.wx-status.ld::after{content:'';display:inline-block;width:14px;height:14px;border:2px solid var(--d200);border-top-color:var(--g500);border-radius:50%;animation:sp .7s linear infinite;margin-left:8px;vertical-align:middle}
@keyframes sp{to{transform:rotate(360deg)}}
.wx-note{text-align:center;font-size:11px;color:var(--d300);margin-top:6px;font-style:italic}
.wx-manual .wx-grid .wx-card{text-align:left;padding:10px}
.wx-manual .wx-card label{font-size:10px;color:var(--d400);font-weight:600;display:block;margin-top:6px}
.wx-manual .wx-card label:first-child{margin-top:0}
.wx-manual .wx-card input,.wx-manual .wx-card select{width:100%;padding:6px 8px;border:1px solid var(--d200);border-radius:6px;font-family:inherit;font-size:12px;margin-top:2px}

.hr-row{display:grid;grid-template-columns:100px 1fr;gap:8px;align-items:start;padding:10px 0;border-bottom:1px solid var(--d100)}
.hr-row:last-child{border-bottom:none}
.hr-row.hdr{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.6px;color:var(--d400);padding-bottom:6px;border-bottom:2px solid var(--d200)}
.hr-row .tb{font-family:'JetBrains Mono',monospace;font-size:12px;font-weight:500;color:var(--g700);padding-top:10px}
.hr-row input{font-family:inherit;font-size:13px;padding:9px 11px;border:1.5px solid var(--d200);border-radius:7px;width:100%}
.hr-row input:focus{outline:none;border-color:var(--g400);box-shadow:0 0 0 3px rgba(91,140,42,.08)}
.hr-row.ah .tb{color:var(--r600);font-weight:600}

.sv-item{display:grid;grid-template-columns:1fr 90px 1fr;gap:10px;align-items:center;padding:12px 0;border-bottom:1px solid var(--d100)}
.sv-item:last-child{border-bottom:none}
.sv-item .q{font-size:13px;color:var(--d700)}
.sv-item select,.sv-item input{font-family:inherit;font-size:12px;padding:8px 10px;border:1.5px solid var(--d200);border-radius:6px}
.sv-item select:focus,.sv-item input:focus{outline:none;border-color:var(--g400);box-shadow:0 0 0 3px rgba(91,140,42,.08)}

.ph-drop{border:2px dashed var(--d200);border-radius:var(--r);padding:30px 16px;text-align:center;cursor:pointer;transition:all .15s;background:var(--d50)}
.ph-drop:hover{border-color:var(--g400);background:var(--g50)}
.ph-drop .ph-ic{font-size:30px;margin-bottom:4px}
.ph-drop p{color:var(--d400);font-size:13px}
.ph-drop .hint{font-size:11px;color:var(--d300);margin-top:2px}
.ph-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px;margin-top:10px}
.ph-card{border-radius:8px;overflow:hidden;border:1px solid var(--d200);background:var(--w)}
.ph-card img{width:100%;height:120px;object-fit:cover;display:block}
.ph-card .ph-info{padding:6px 8px}
.ph-card .ph-info input{width:100%;font-family:inherit;font-size:11px;padding:5px 7px;border:1px solid var(--d200);border-radius:4px;margin-top:3px}
.ph-card .ph-info input:focus{outline:none;border-color:var(--g400)}
.ph-card .ph-nm{font-size:10px;color:var(--d300);white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
.ph-card .ph-ts{font-size:9px;color:var(--g600);font-family:'JetBrains Mono',monospace;margin-top:2px}
.ph-card .ph-rm{font-size:10px;color:var(--r600);cursor:pointer;border:none;background:none;font-family:inherit;font-weight:600;padding:2px 0}

.sig-g{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.sig-b label{font-size:11px;font-weight:600;color:var(--d500);text-transform:uppercase;letter-spacing:.5px;display:block;margin-bottom:5px}
.sig-b input{width:100%;font-family:inherit;font-size:14px;padding:10px 12px;border:none;border-bottom:2px solid var(--d200);background:transparent;transition:border .15s}
.sig-b input:focus{outline:none;border-bottom-color:var(--g500)}

.email-row{display:grid;grid-template-columns:1fr 1fr;gap:14px;margin-top:14px}
.email-note{font-size:11px;color:var(--d400);margin-top:6px;font-style:italic}

/* Success toast */
.toast{position:fixed;bottom:30px;left:50%;transform:translateX(-50%) translateY(100px);background:var(--g700);color:var(--w);padding:14px 24px;border-radius:var(--r);font-size:14px;font-weight:600;box-shadow:var(--sh-l);z-index:2000;transition:transform .3s ease;display:flex;align-items:center;gap:8px}
.toast.show{transform:translateX(-50%) translateY(0)}
.toast.error{background:var(--r600)}

/* Print overlay */
#po{display:none;position:fixed;inset:0;z-index:1000;background:rgba(0,0,0,.55);overflow-y:auto}
#po.on{display:block}
#pc{max-width:820px;margin:24px auto;background:var(--w);border-radius:var(--rl);box-shadow:var(--sh-l);overflow:hidden}
.pt{display:flex;justify-content:space-between;align-items:center;padding:14px 20px;background:var(--d50);border-bottom:1px solid var(--d200)}
.pt h3{font-size:15px;color:var(--d800)}
.pt .btns{display:flex;gap:8px;flex-wrap:wrap}

/* Report */
.rpt-hdr{background:linear-gradient(135deg,var(--g800),var(--g600));color:var(--w);padding:24px 28px;display:flex;justify-content:space-between;align-items:center}
.rpt-hdr .rpt-logo{display:flex;align-items:center;gap:12px}
.rpt-hdr .rpt-logo .mark{width:48px;height:48px;background:var(--w);border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;color:var(--g700);font-size:24px}
.rpt-hdr h1{font-size:20px;font-weight:700}
.rpt-hdr .rpt-sub{font-size:13px;opacity:.8}
.rpt-meta{display:grid;grid-template-columns:repeat(3,1fr);border-bottom:2px solid var(--g400)}
.rpt-meta .mi{padding:10px 16px;border-right:1px solid var(--d200);background:var(--d50)}
.rpt-meta .mi:last-child{border-right:none}
.rpt-meta .ml{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:var(--d400)}
.rpt-meta .mv{font-size:13px;font-weight:600;color:var(--d800);margin-top:1px}
.rpt-sec{padding:18px 28px;border-bottom:1px solid var(--d100)}
.rpt-sec:last-child{border-bottom:none}
.rpt-sec h2{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;color:var(--g700);margin-bottom:12px;padding-bottom:5px;border-bottom:2px solid var(--g200)}
.rpt-wx{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.rpt-wxc{text-align:center;padding:12px;background:var(--g50);border-radius:8px;border:1px solid var(--g200)}
.rpt-wxc .rwt{font-size:10px;font-weight:700;color:var(--g600);text-transform:uppercase;letter-spacing:.4px}
.rpt-wxc .rwi{font-size:22px;margin:3px 0}
.rpt-wxc .rwtp{font-size:28px;font-weight:800;color:var(--g800)}
.rpt-wxc .rwc{font-size:12px;color:var(--g600)}
.rpt-wxc .rwd{font-size:10px;color:var(--d400);margin-top:4px}
table.rt{width:100%;border-collapse:collapse;font-size:12px}
table.rt th{background:var(--d100);font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:.3px;color:var(--d500);padding:7px 12px;text-align:left;border-bottom:2px solid var(--d200)}
table.rt td{padding:7px 12px;border-bottom:1px solid var(--d100);color:var(--d700)}
table.rt tr:nth-child(even) td{background:var(--d50)}
table.rt .tc{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500;color:var(--g700);white-space:nowrap}
table.rt .ah-row td{background:var(--r100)!important}
table.rt .ah-row .tc{color:var(--r600)}
.sv-r{display:flex;align-items:baseline;gap:8px;padding:6px 0;border-bottom:1px solid var(--d100);font-size:12px}
.sv-r:last-child{border-bottom:none}
.badge{font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px;white-space:nowrap}
.b-y{background:var(--g100);color:var(--g700)}.b-n{background:var(--r100);color:var(--r600)}.b-na{background:var(--d100);color:var(--d400)}
.rpt-notes{background:var(--d50);border-radius:8px;padding:12px 14px;font-size:12px;color:var(--d700);white-space:pre-wrap;min-height:30px}
.rpt-ph{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
.rpt-phc{border-radius:8px;overflow:hidden;border:1px solid var(--d200)}
.rpt-phc img{width:100%;height:130px;object-fit:cover}
.rpt-phc .rpc{padding:5px 7px;font-size:10px;color:var(--d500)}
.rpt-phc .rpc .rp-ts{font-family:'JetBrains Mono',monospace;font-size:9px;color:var(--g600)}
.rpt-sigs{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:8px}
.rpt-sig .rs-l{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;color:var(--d400)}
.rpt-sig .rs-n{font-size:15px;font-weight:600;color:var(--d800);border-bottom:2px solid var(--d200);padding-bottom:3px;margin-top:3px;min-height:24px}
.rpt-sig .rs-d{font-size:11px;color:var(--d400);margin-top:3px}
.rpt-ft{text-align:center;padding:14px;font-size:10px;color:var(--d300);font-style:italic;border-top:1px solid var(--d100)}

@media print{
  body{background:#fff}
  .app-hdr,.ctn,.queue-bar,.toast,#po .pt{display:none!important}
  #po{position:static;background:none;display:block!important}
  #pc{margin:0;box-shadow:none;border-radius:0;max-width:100%}
  #pb *{-webkit-print-color-adjust:exact!important;print-color-adjust:exact!important;color-adjust:exact!important}
  #pb img{display:inline-block!important;visibility:visible!important}
}

@media(max-width:680px){
  .fg{grid-template-columns:1fr}
  .wx-grid{grid-template-columns:1fr}
  .sv-item{grid-template-columns:1fr 80px}.sv-item input[type=text]{grid-column:1/-1}
  .sig-g,.email-row{grid-template-columns:1fr}
  .rpt-meta{grid-template-columns:1fr}
  .rpt-wx{grid-template-columns:1fr}
  .rpt-sigs{grid-template-columns:1fr}
  .app-hdr{flex-direction:column;gap:10px;text-align:center}
  .hdr-btns{width:100%;justify-content:center}
  .pt{flex-direction:column;gap:8px}
  .pt .btns{width:100%;justify-content:center}
}
</style>
</head>
<body>

<!-- Queue status bar -->
<div class="queue-bar" id="queueBar"></div>

<div class="app-hdr">
  <div class="logo-area">
    <img src="data:image/webp;base64,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" alt="Optimum" style="height:40px;width:auto">
    <div class="logo-text">
      <h1>Optimum Rope Access</h1>
      <div class="sub">Daily Field Report</div>
    </div>
  </div>
  <div class="hdr-btns">
    <button class="btn btn-g" onclick="clearForm()">‚Üª Clear</button>
    <button class="btn btn-w" onclick="submitReport()">üì§ Submit Report</button>
  </div>
</div>

<div class="ctn">

<!-- PROJECT INFO -->
<div class="sec">
  <div class="sec-h"><span class="ic">üìã</span> Project Information</div>
  <div class="sec-b">
    <div class="fg">
      <div class="fi"><label>Date</label><input type="date" id="rptDate"></div>
      <div class="fi"><label>Job #</label><input type="text" id="jobNum" placeholder="e.g. ORA-2026-042"></div>
      <div class="fi full">
        <label>Project</label>
        <div class="dd-wrap" id="wrap_project">
          <select id="sel_project"><option value="">‚Äî Select Project ‚Äî</option></select>
          <input type="text" class="oth-in" id="oth_project" placeholder="Type project name...">
          <label class="oth-tog"><input type="checkbox" onchange="toggleOther('project',this.checked)"><span>Other</span></label>
        </div>
      </div>
      <div class="fi">
        <label>Client</label>
        <div class="dd-wrap" id="wrap_client">
          <select id="sel_client"><option value="">‚Äî Select Client ‚Äî</option></select>
          <input type="text" class="oth-in" id="oth_client" placeholder="Type client name...">
          <label class="oth-tog"><input type="checkbox" onchange="toggleOther('client',this.checked)"><span>Other</span></label>
        </div>
      </div>
      <div class="fi">
        <label>Location</label>
        <div class="dd-wrap" id="wrap_location">
          <select id="sel_location" onchange="onLocationChange()"><option value="">‚Äî Select Location ‚Äî</option></select>
          <input type="text" class="oth-in" id="oth_location" placeholder="Type location...">
          <label class="oth-tog"><input type="checkbox" onchange="toggleOther('location',this.checked);if(this.checked)clearWeather()"><span>Other</span></label>
        </div>
      </div>
      <div class="fi"><label>WTG / Turbine #</label><input type="text" id="wtg" placeholder="e.g. A-130"></div>
      <div class="fi">
        <label>Prepared By</label>
        <div class="dd-wrap" id="wrap_prepBy">
          <select id="sel_prepBy" onchange="onPrepByChange()"><option value="">‚Äî Select ‚Äî</option></select>
          <input type="text" class="oth-in" id="oth_prepBy" placeholder="Type name...">
          <label class="oth-tog"><input type="checkbox" onchange="toggleOther('prepBy',this.checked)"><span>Other</span></label>
        </div>
      </div>
      <div class="fi"><label>Team Members</label><input type="text" id="teamMembers" placeholder="e.g. Parker Wood, Beau Naulu"></div>
    </div>
    <div class="email-row">
      <div class="fi"><label>Preparer's Email</label><input type="email" id="prepEmail" placeholder="Auto-fills or type email"></div>
      <div class="fi"><label>CC Email</label><input type="email" id="ccEmail" value="Services@OptimumRAS.com"></div>
    </div>
    <div class="email-note">Report saves to your device and auto-sends to the shared SharePoint folder</div>
  </div>
</div>

<!-- WEATHER -->
<div class="sec">
  <div class="sec-h"><span class="ic">üå§Ô∏è</span> Weather Conditions</div>
  <div class="sec-b">
    <div id="wxContent"><div class="wx-status">Select a location to auto-fetch weather</div></div>
    <div class="wx-note" id="wxNote" style="display:none">Weather auto-fetched ¬∑ Editable if needed</div>
  </div>
</div>

<!-- HOURLY LOG -->
<div class="sec">
  <div class="sec-h"><span class="ic">‚è±Ô∏è</span> Hourly Work Log</div>
  <div class="sec-b">
    <div class="hr-row hdr"><div>Time</div><div>Work Description</div></div>
    <div id="hrRows"></div>
  </div>
</div>

<!-- AFTER HOURS -->
<div class="sec">
  <div class="sec-h red"><span class="ic">üö®</span> After Hours (1800+) ‚Äî Requires Client Approval</div>
  <div class="sec-b"><div id="ahRows"></div></div>
</div>

<!-- CHECKLIST -->
<div class="sec">
  <div class="sec-h"><span class="ic">‚úÖ</span> Safety & Operations Checklist</div>
  <div class="sec-b"><div id="svItems"></div></div>
</div>

<!-- NOTES -->
<div class="sec">
  <div class="sec-h"><span class="ic">üìù</span> Observations & Notes</div>
  <div class="sec-b">
    <div class="fg" style="grid-template-columns:1fr">
      <div class="fi"><label>Safety Observations / Lessons Learned / Personnel Performance</label><textarea id="safetyNotes" rows="3" placeholder="Enter any safety observations..."></textarea></div>
      <div class="fi"><label>Additional Notes / Items Needed for Tomorrow</label><textarea id="addNotes" rows="3" placeholder="Materials needed, equipment issues, plan for tomorrow..."></textarea></div>
    </div>
  </div>
</div>

<!-- BEFORE PHOTOS -->
<div class="sec">
  <div class="sec-h"><span class="ic">üì∑</span> Before Photos</div>
  <div class="sec-b">
    <div class="ph-drop" onclick="document.getElementById('phBefore').click()">
      <div class="ph-ic">üì∏</div><p>Tap to take photo or upload</p><div class="hint">Photos timestamped automatically</div>
    </div>
    <input type="file" id="phBefore" multiple accept="image/*" style="display:none" onchange="handlePhotos(this.files,'before')">
    <div class="ph-grid" id="gridBefore"></div>
  </div>
</div>

<!-- AFTER PHOTOS -->
<div class="sec">
  <div class="sec-h"><span class="ic">üì∑</span> After Photos</div>
  <div class="sec-b">
    <div class="ph-drop" onclick="document.getElementById('phAfter').click()">
      <div class="ph-ic">üì∏</div><p>Tap to take photo or upload</p><div class="hint">Photos timestamped automatically</div>
    </div>
    <input type="file" id="phAfter" multiple accept="image/*" style="display:none" onchange="handlePhotos(this.files,'after')">
    <div class="ph-grid" id="gridAfter"></div>
  </div>
</div>

<!-- SIGN OFF -->
<div class="sec">
  <div class="sec-h"><span class="ic">‚úçÔ∏è</span> Sign-Off</div>
  <div class="sec-b">
    <div class="sig-g">
      <div class="sig-b"><label>Technician Name</label><input type="text" id="techSig" placeholder="Full name"></div>
      <div class="sig-b"><label>Supervisor Name</label><input type="text" id="superSig" placeholder="Full name"></div>
    </div>
  </div>
</div>

<div style="text-align:center;padding:18px 0">
  <button class="btn btn-green" onclick="submitReport()" style="font-size:15px;padding:14px 32px">üì§ Submit Report</button>
</div>
</div>

<!-- TOAST -->
<div class="toast" id="toast"></div>

<!-- PRINT OVERLAY -->
<div id="po">
  <div id="pc">
    <div class="pt">
      <h3>Report Preview</h3>
      <div class="btns">
        <button class="btn btn-green" onclick="downloadReport()">üíæ Save PDF</button>
        <button class="btn btn-green" onclick="shareReport()" id="shareBtn" style="display:none">üì§ Share / Save to Files</button>
        <button class="btn btn-green" onclick="window.print()">üñ®Ô∏è Print</button>
        <button class="btn btn-g" onclick="closePrint()" style="color:var(--d700);border-color:var(--d300)">‚úï Close</button>
      </div>
    </div>
    <div id="pb"></div>
  </div>
</div>

<script>
/*
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                                                                  ‚ïë
‚ïë   MASTER LISTS ‚Äî EDIT THESE TO UPDATE ALL DROPDOWNS              ‚ïë
‚ïë                                                                  ‚ïë
‚ïë   To add a new item:    Copy an existing line and change it      ‚ïë
‚ïë   To remove an item:    Delete that line                         ‚ïë
‚ïë   Then save this file ‚Äî every tech gets the update automatically ‚ïë
‚ïë                                                                  ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
*/

const MASTER = {

  // ‚îÄ‚îÄ‚îÄ ACTIVE PROJECTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Add new projects here. One per line. Keep the quotes and comma.
  projects: [
    "2602_UpTower_BullCreek_NacelleRepair_Onshore",
    "Blattner_SunZia_NacelleVent",
    "Blattner_SunZia_BladeRepair",
    "GE_Onshore_Maintenance",
    "GE_Offshore_Inspection",
    "Academy_Training",
    "Internal_Operations",
  ],

  // ‚îÄ‚îÄ‚îÄ CLIENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  clients: [
    "Blattner Energy",
    "GE Renewables",
    "Uptower",
    "Vestas",
    "Siemens Gamesa",
  ],

  // ‚îÄ‚îÄ‚îÄ LOCATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Each location needs GPS coordinates for auto-weather.
  // To find coordinates: Google Maps ‚Üí right-click location ‚Üí copy coordinates
  // Format: { name: "Display Name", lat: ##.####, lon: -###.#### }
  locations: [
    { name: "Bull Creek, TX",         lat: 32.10,   lon: -100.54 },
    { name: "Clines Corners, NM",     lat: 34.9917, lon: -105.4308 },
    { name: "Amarillo, TX",           lat: 35.2220, lon: -101.8313 },
    { name: "Sweetwater, TX",         lat: 32.4707, lon: -100.4059 },
    { name: "Oklahoma City, OK",      lat: 35.4676, lon: -97.5164 },
  ],

  // ‚îÄ‚îÄ‚îÄ TEAM MEMBERS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
  // Each person needs a name and email.
  // Email auto-fills when they select their name.
  // Format: { name: "Full Name", email: "name@optimumras.com" }
  team: [
    { name: "Travis Staggs", email: "travis@optimumras.com" },
    { name: "Parker Wood",   email: "parker@optimumras.com" },
    { name: "Beau Naulu",    email: "beau@optimumras.com" },
    { name: "Todd Bentley",  email: "todd@optimumras.com" },
  ],

};

/*
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë   POWER AUTOMATE WEBHOOK URL                                     ‚ïë
‚ïë                                                                  ‚ïë
‚ïë   Replace the URL below with your Power Automate HTTP trigger.   ‚ïë
‚ïë   See setup instructions in the README.                          ‚ïë
‚ïë                                                                  ‚ïë
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
*/

const WEBHOOK_URL = "https://default48cc6af00072430fa8a19178d1b272.f7.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/f91c58df7bf04a0f8a999363fa357243/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=dZTNJCpdsrkFI4THBXuNPe3OEEQjyom4cRG7BBlmKAg";

/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê END OF EDITABLE SECTION ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */


// ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ
const TB = ['0600-0700','0700-0800','0800-0900','0900-1000','1000-1100','1100-1200','1200-1300','1300-1400','1400-1500','1500-1600','1600-1700','1700-1800'];
const AH = ['1800-1900','1900-2000','2000+'];
const SQ = [
  'Did you complete your JHA form and Daily Progress checklist today?',
  'Did you receive all necessary instructions and information for today\'s work?',
  'Did you experience any delays today? If so, describe in Notes.',
  'Was all required equipment available and functioning properly?',
  'Were there any safety incidents, near misses, or hazards observed?',
  'Are there any unresolved issues that need management attention?',
  'Any material or equipment shortages expected for tomorrow?'
];
let photosBefore = [], photosAfter = [], weatherData = null, reportHTML = '';

// ‚îÄ‚îÄ‚îÄ INIT ‚îÄ‚îÄ‚îÄ
function init() {
  document.getElementById('rptDate').valueAsDate = new Date();
  populateDDs();
  buildHR();
  buildAH();
  buildSV();
  setupDD();
  loadQueue();
  window.addEventListener('online', processQueue);
}

function populateDDs() {
  const ps = document.getElementById('sel_project');
  MASTER.projects.forEach(p => { const o = new Option(p, p); ps.add(o); });
  const cs = document.getElementById('sel_client');
  MASTER.clients.forEach(c => { const o = new Option(c, c); cs.add(o); });
  const ls = document.getElementById('sel_location');
  MASTER.locations.forEach(l => { const o = new Option(l.name, `${l.lat},${l.lon}`); ls.add(o); });
  const ts = document.getElementById('sel_prepBy');
  MASTER.team.forEach(t => { const o = new Option(t.name, t.name); ts.add(o); });
}

function buildHR() {
  document.getElementById('hrRows').innerHTML = TB.map((t,i) =>
    `<div class="hr-row"><div class="tb">${t}</div><input type="text" id="d${i}" placeholder="Description of work performed..."></div>`
  ).join('');
}
function buildAH() {
  document.getElementById('ahRows').innerHTML = AH.map((t,i) =>
    `<div class="hr-row ah"><div class="tb">${t}</div><input type="text" id="ah${i}" placeholder="Description (requires client approval)..."></div>`
  ).join('');
}
function buildSV() {
  document.getElementById('svItems').innerHTML = SQ.map((q,i) =>
    `<div class="sv-item"><div class="q">${q}</div><select id="sv${i}"><option value="">‚Äî</option><option>Yes</option><option>No</option><option>N/A</option></select><input type="text" id="svn${i}" placeholder="Notes..."></div>`
  ).join('');
}

// ‚îÄ‚îÄ‚îÄ OTHER TOGGLE ‚îÄ‚îÄ‚îÄ
function toggleOther(f, on) {
  const w = document.getElementById('wrap_' + f);
  on ? w.classList.add('oth-on') : w.classList.remove('oth-on');
}
function getVal(f) {
  const w = document.getElementById('wrap_' + f);
  return w.classList.contains('oth-on') ? document.getElementById('oth_' + f).value : document.getElementById('sel_' + f).value;
}
function getLocName() {
  const w = document.getElementById('wrap_location');
  if (w.classList.contains('oth-on')) return document.getElementById('oth_location').value;
  return document.getElementById('sel_location').selectedOptions[0]?.text || '';
}

function onPrepByChange() {
  const m = MASTER.team.find(t => t.name === document.getElementById('sel_prepBy').value);
  if (m) document.getElementById('prepEmail').value = m.email;
}

// ‚îÄ‚îÄ‚îÄ WEATHER ‚îÄ‚îÄ‚îÄ
function onLocationChange() {
  const v = document.getElementById('sel_location').value;
  if (!v) { clearWeather(); return; }
  const [lat, lon] = v.split(',');
  fetchWx(lat, lon);
}
function clearWeather() {
  document.getElementById('wxContent').innerHTML = '<div class="wx-status">Select a location to auto-fetch weather</div>';
  document.getElementById('wxNote').style.display = 'none';
  weatherData = null;
}
async function fetchWx(lat, lon) {
  const el = document.getElementById('wxContent');
  el.innerHTML = '<div class="wx-status ld">Fetching weather</div>';
  try {
    const d = document.getElementById('rptDate').value || new Date().toISOString().split('T')[0];
    const resp = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&hourly=temperature_2m,relative_humidity_2m,precipitation,wind_speed_10m,weather_code&temperature_unit=fahrenheit&wind_speed_unit=mph&precipitation_unit=inch&start_date=${d}&end_date=${d}&timezone=America/Chicago`);
    const data = await resp.json();
    if (!data.hourly) throw 0;
    const h = data.hourly;
    weatherData = [{l:'6:00 AM',i:6},{l:'12:00 PM',i:12},{l:'4:00 PM',i:16}].map(s => ({
      time:s.l, temp:Math.round(h.temperature_2m[s.i]), humidity:Math.round(h.relative_humidity_2m[s.i]),
      precip:h.precipitation[s.i].toFixed(1), wind:Math.round(h.wind_speed_10m[s.i]),
      cond:wxT(h.weather_code[s.i]), icon:wxI(h.weather_code[s.i])
    }));
    renderWx();
    document.getElementById('wxNote').style.display = 'block';
  } catch(e) {
    el.innerHTML = '<div class="wx-status">‚ö†Ô∏è Could not fetch weather ‚Äî enter manually</div>';
    renderManWx();
  }
}
function wxT(c){const m={0:'Clear',1:'Mainly Clear',2:'Partly Cloudy',3:'Overcast',45:'Fog',48:'Rime Fog',51:'Light Drizzle',53:'Drizzle',55:'Heavy Drizzle',61:'Light Rain',63:'Rain',65:'Heavy Rain',71:'Light Snow',73:'Snow',75:'Heavy Snow',80:'Showers',81:'Showers',82:'Heavy Showers',95:'Thunderstorm',96:'T-storm/Hail'};return m[c]||'Unknown'}
function wxI(c){if(c<=1)return'‚òÄÔ∏è';if(c===2)return'‚õÖ';if(c===3)return'‚òÅÔ∏è';if(c>=45&&c<=48)return'üå´Ô∏è';if(c>=51&&c<=65)return'üåßÔ∏è';if(c>=71&&c<=86)return'‚ùÑÔ∏è';if(c>=95)return'‚õàÔ∏è';return'üå§Ô∏è'}
function renderWx(){
  if(!weatherData)return;
  document.getElementById('wxContent').innerHTML=`<div class="wx-grid">${weatherData.map(w=>`<div class="wx-card"><div class="wx-t">${w.time}</div><div class="wx-icon">${w.icon}</div><div class="wx-temp">${w.temp}<span>¬∞F</span></div><div class="wx-cond">${w.cond}</div><div class="wx-det"><span>üí® ${w.wind}mph</span><span>üíß ${w.precip}"</span><span>‚òÅ ${w.humidity}%</span></div></div>`).join('')}</div>`;
}
function renderManWx(){
  document.getElementById('wxContent').innerHTML+=`<div class="wx-manual"><div class="wx-grid">${['6:00 AM','12:00 PM','4:00 PM'].map((t,i)=>`<div class="wx-card"><div class="wx-t" style="text-align:center;font-size:11px;font-weight:700;color:var(--g600)">${t}</div><label>Temp (¬∞F)</label><input type="number" id="mt${i}"><label>Conditions</label><select id="mc${i}"><option>Clear</option><option>Partly Cloudy</option><option>Overcast</option><option>Rain</option><option>Snow</option><option>Fog</option><option>High Winds</option></select><label>Wind (MPH)</label><input type="number" id="mw${i}"><label>Humidity (%)</label><input type="number" id="mh${i}"></div>`).join('')}</div></div>`;
}

// ‚îÄ‚îÄ‚îÄ PHOTOS ‚îÄ‚îÄ‚îÄ
function setupDD(){
  const drops = document.querySelectorAll('.ph-drop');
  drops.forEach((area, idx) => {
    const type = idx === 0 ? 'before' : 'after';
    ['dragenter','dragover'].forEach(e => area.addEventListener(e, ev => {ev.preventDefault();area.style.borderColor='var(--g400)';area.style.background='var(--g50)'}));
    area.addEventListener('dragleave', ev => {ev.preventDefault();area.style.borderColor='';area.style.background=''});
    area.addEventListener('drop', ev => {ev.preventDefault();area.style.borderColor='';area.style.background='';handlePhotos(ev.dataTransfer.files,type)});
  });
}

function handlePhotos(files, type) {
  for (const file of files) {
    if (!file.type.startsWith('image/')) continue;
    const reader = new FileReader();
    reader.onload = e => stampPhoto(e.target.result, (stamped, ts) => {
      (type==='before'?photosBefore:photosAfter).push({name:file.name, data:stamped, caption:'', timestamp:ts});
      renderPh(type);
    });
    reader.readAsDataURL(file);
  }
}

function stampPhoto(src, cb) {
  const img = new Image();
  img.onload = () => {
    const c = document.createElement('canvas');
    const ctx = c.getContext('2d');
    c.width = img.width; c.height = img.height;
    ctx.drawImage(img, 0, 0);
    const now = new Date();
    const ts = now.toLocaleString('en-US',{month:'2-digit',day:'2-digit',year:'numeric',hour:'2-digit',minute:'2-digit',second:'2-digit'});
    const loc = getLocName() || 'Location N/A';
    const txt = `${ts}  |  ${loc}`;
    const bH = Math.max(28, img.height*.035);
    const fS = Math.max(14, bH*.55);
    ctx.fillStyle = 'rgba(0,0,0,0.65)';
    ctx.fillRect(0, img.height-bH, img.width, bH);
    ctx.font = `600 ${fS}px monospace`;
    ctx.fillStyle = '#fff';
    ctx.textBaseline = 'middle';
    ctx.fillText(txt, 10, img.height-bH/2);
    cb(c.toDataURL('image/jpeg',0.85), ts);
  };
  img.src = src;
}

function renderPh(type) {
  const arr = type==='before'?photosBefore:photosAfter;
  const grid = document.getElementById(type==='before'?'gridBefore':'gridAfter');
  grid.innerHTML = arr.map((p,i) =>
    `<div class="ph-card"><img src="${p.data}"><div class="ph-info"><div class="ph-nm">${p.name}</div><div class="ph-ts">${p.timestamp}</div><input type="text" placeholder="Add caption..." value="${p.caption}" onchange="${type==='before'?'photosBefore':'photosAfter'}[${i}].caption=this.value"><button class="ph-rm" onclick="${type==='before'?'photosBefore':'photosAfter'}.splice(${i},1);renderPh('${type}')">Remove</button></div></div>`
  ).join('');
}

// ‚îÄ‚îÄ‚îÄ FILE NAME ‚îÄ‚îÄ‚îÄ
// Format: JobNumber_ProjectName_mmddyyyy
function getFN() {
  const d = document.getElementById('rptDate').value;
  const jobNum = document.getElementById('jobNum').value || 'NoJobNum';
  const project = getVal('project') || 'Report';
  if (!d) return `${jobNum}_${project}`;
  const p = d.split('-');
  return `${jobNum}_${project}_${p[1]}${p[2]}${p[0]}`;
}

// ‚îÄ‚îÄ‚îÄ BUILD REPORT HTML ‚îÄ‚îÄ‚îÄ
function buildReport() {
  const d = {
    date:document.getElementById('rptDate').value, jobNum:document.getElementById('jobNum').value,
    project:getVal('project'), client:getVal('client'), location:getLocName(),
    wtg:document.getElementById('wtg').value, prepBy:getVal('prepBy'), team:document.getElementById('teamMembers').value
  };
  const dateF = d.date ? new Date(d.date+'T12:00:00').toLocaleDateString('en-US',{weekday:'long',year:'numeric',month:'long',day:'numeric'}) : 'Not specified';
  const now = new Date().toLocaleString('en-US');
  const fn = getFN();

  const hourly = TB.map((t,i)=>({time:t,desc:document.getElementById(`d${i}`).value,ah:false})).filter(h=>h.desc);
  const afterH = AH.map((t,i)=>({time:t,desc:document.getElementById(`ah${i}`).value,ah:true})).filter(h=>h.desc);
  const allH = [...hourly,...afterH];
  const survey = SQ.map((q,i)=>({q,a:document.getElementById(`sv${i}`).value,n:document.getElementById(`svn${i}`).value}));
  const sN = document.getElementById('safetyNotes').value;
  const aN = document.getElementById('addNotes').value;
  const tS = document.getElementById('techSig').value;
  const sS = document.getElementById('superSig').value;

  let h = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>${fn}</title>
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
<style>*{margin:0;padding:0;box-sizing:border-box}body{font-family:'Outfit',sans-serif;color:#1e1e1e;line-height:1.5;background:#fff}
.rpt-hdr{background:linear-gradient(135deg,#2d5a14,#4a7a20);color:#fff;padding:24px 28px;display:flex;align-items:center;gap:12px}
.mark{width:48px;height:48px;background:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;color:#3d6b1a;font-size:24px}
.rpt-hdr h1{font-size:20px;font-weight:700}.rpt-sub{font-size:13px;opacity:.8}
.rpt-meta{display:grid;grid-template-columns:repeat(3,1fr);border-bottom:2px solid #7db043}
.mi{padding:10px 16px;border-right:1px solid #ccc;background:#f4f4f4}.mi:last-child{border-right:none}
.ml{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.5px;color:#888}
.mv{font-size:13px;font-weight:600;margin-top:1px}
.rpt-sec{padding:18px 28px;border-bottom:1px solid #e8e8e8}
.rpt-sec h2{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;color:#3d6b1a;margin-bottom:12px;padding-bottom:5px;border-bottom:2px solid #d4e8b8}
.rpt-wx{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
.rwxc{text-align:center;padding:12px;background:#f5faf0;border-radius:8px;border:1px solid #d4e8b8}
.rwt{font-size:10px;font-weight:700;color:#4a7a20;text-transform:uppercase}.rwi{font-size:22px;margin:3px 0}
.rwtp{font-size:28px;font-weight:800;color:#2d5a14}.rwc{font-size:12px;color:#4a7a20}.rwd{font-size:10px;color:#888;margin-top:4px}
table{width:100%;border-collapse:collapse;font-size:12px}
th{background:#e8e8e8;font-size:10px;font-weight:700;text-transform:uppercase;color:#666;padding:7px 12px;text-align:left;border-bottom:2px solid #ccc}
td{padding:7px 12px;border-bottom:1px solid #e8e8e8}tr:nth-child(even) td{background:#f4f4f4}
.tc{font-family:'JetBrains Mono',monospace;font-size:11px;font-weight:500;color:#3d6b1a;white-space:nowrap}
.ah-row td{background:#fde8e5!important}.ah-row .tc{color:#c0392b}
.sv-r{display:flex;align-items:baseline;gap:8px;padding:6px 0;border-bottom:1px solid #e8e8e8;font-size:12px}
.badge{font-size:10px;font-weight:700;padding:2px 7px;border-radius:4px}
.b-y{background:#eaf4dc;color:#3d6b1a}.b-n{background:#fde8e5;color:#c0392b}.b-na{background:#e8e8e8;color:#888}
.rpt-notes{background:#f4f4f4;border-radius:8px;padding:12px 14px;font-size:12px;white-space:pre-wrap;min-height:30px}
.rpt-ph{display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:8px}
.rpt-phc{border-radius:8px;overflow:hidden;border:1px solid #ccc}
.rpt-phc img{width:100%;height:130px;object-fit:cover}.rpc{padding:5px 7px;font-size:10px;color:#666}
.rp-ts{font-family:'JetBrains Mono',monospace;font-size:9px;color:#4a7a20}
.rpt-sigs{display:grid;grid-template-columns:1fr 1fr;gap:24px;margin-top:8px}
.rs-l{font-size:9px;font-weight:700;text-transform:uppercase;letter-spacing:.4px;color:#888}
.rs-n{font-size:15px;font-weight:600;border-bottom:2px solid #ccc;padding-bottom:3px;margin-top:3px;min-height:24px}
.rs-d{font-size:11px;color:#888;margin-top:3px}
.rpt-ft{text-align:center;padding:14px;font-size:10px;color:#aaa;font-style:italic;border-top:1px solid #e8e8e8}
</style></head><body>`;

  h += `<div class="rpt-hdr"><img src="data:image/webp;base64,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" alt="Optimum" style="height:44px;width:auto"><div><h1>OPTIMUM ROPE ACCESS</h1><div class="rpt-sub">Daily Field Report ‚Äî ${dateF}</div></div></div>
  <div class="rpt-meta">
    <div class="mi"><div class="ml">Project</div><div class="mv">${d.project||'‚Äî'}</div></div>
    <div class="mi"><div class="ml">Client</div><div class="mv">${d.client||'‚Äî'}</div></div>
    <div class="mi"><div class="ml">Job #</div><div class="mv">${d.jobNum||'‚Äî'}</div></div>
    <div class="mi"><div class="ml">Location</div><div class="mv">${d.location||'‚Äî'}</div></div>
    <div class="mi"><div class="ml">WTG / Turbine</div><div class="mv">${d.wtg||'‚Äî'}</div></div>
    <div class="mi"><div class="ml">Prepared By</div><div class="mv">${d.prepBy||'‚Äî'}</div></div>
    <div class="mi"><div class="ml">Team Members</div><div class="mv">${d.team||'‚Äî'}</div></div>
    <div class="mi"><div class="ml">Report Generated</div><div class="mv">${now}</div></div>
    <div class="mi"><div class="ml">File</div><div class="mv">${fn}</div></div>
  </div>`;

  // Weather
  const wxArr = weatherData || [0,1,2].map(i => {
    const t = document.getElementById(`mt${i}`);
    if (!t || !t.value) return null;
    return {time:['6:00 AM','12:00 PM','4:00 PM'][i],temp:t.value,cond:document.getElementById(`mc${i}`).value,wind:document.getElementById(`mw${i}`).value||'‚Äî',humidity:document.getElementById(`mh${i}`).value||'‚Äî',icon:'üå§Ô∏è',precip:'0'};
  }).filter(Boolean);

  if (wxArr.length) {
    h += `<div class="rpt-sec"><h2>Weather Conditions</h2><div class="rpt-wx">${wxArr.map(w =>
      `<div class="rwxc"><div class="rwt">${w.time}</div><div class="rwi">${w.icon||'üå§Ô∏è'}</div><div class="rwtp">${w.temp}¬∞F</div><div class="rwc">${w.cond}</div><div class="rwd">Wind: ${w.wind}mph ¬∑ ${w.precip!==undefined?'Precip: '+w.precip+'" ¬∑ ':''}Humidity: ${w.humidity}%</div></div>`
    ).join('')}</div></div>`;
  }

  if (allH.length) {
    h += `<div class="rpt-sec"><h2>Hourly Work Log</h2><table><thead><tr><th>Time</th><th>Description</th></tr></thead><tbody>${allH.map(r =>
      `<tr class="${r.ah?'ah-row':''}"><td class="tc">${r.time}</td><td>${r.desc}</td></tr>`
    ).join('')}</tbody></table></div>`;
  }

  h += `<div class="rpt-sec"><h2>Safety & Operations Checklist</h2>${survey.map(s => {
    const bc = s.a==='Yes'?'b-y':s.a==='No'?'b-n':'b-na';
    return `<div class="sv-r"><span class="badge ${bc}">${s.a||'‚Äî'}</span><span>${s.q}</span>${s.n?`<span style="color:#888;font-style:italic;margin-left:auto"> ‚Äî ${s.n}</span>`:''}</div>`;
  }).join('')}</div>`;

  if (sN || aN) {
    h += `<div class="rpt-sec"><h2>Observations & Notes</h2>`;
    if (sN) h += `<div style="margin-bottom:10px"><strong style="font-size:11px;color:#888;text-transform:uppercase">Safety / Lessons Learned</strong><div class="rpt-notes">${sN}</div></div>`;
    if (aN) h += `<div><strong style="font-size:11px;color:#888;text-transform:uppercase">Additional Notes</strong><div class="rpt-notes">${aN}</div></div>`;
    h += `</div>`;
  }

  if (photosBefore.length) {
    h += `<div class="rpt-sec"><h2>Before Photos (${photosBefore.length})</h2><div class="rpt-ph">${photosBefore.map(p =>
      `<div class="rpt-phc"><img src="${p.data}"><div class="rpc">${p.caption||p.name}<br><span class="rp-ts">${p.timestamp}</span></div></div>`
    ).join('')}</div></div>`;
  }
  if (photosAfter.length) {
    h += `<div class="rpt-sec"><h2>After Photos (${photosAfter.length})</h2><div class="rpt-ph">${photosAfter.map(p =>
      `<div class="rpt-phc"><img src="${p.data}"><div class="rpc">${p.caption||p.name}<br><span class="rp-ts">${p.timestamp}</span></div></div>`
    ).join('')}</div></div>`;
  }

  h += `<div class="rpt-sec"><h2>Sign-Off</h2><div class="rpt-sigs">
    <div><div class="rs-l">Technician</div><div class="rs-n">${tS||''}</div><div class="rs-d">${now}</div></div>
    <div><div class="rs-l">Supervisor</div><div class="rs-n">${sS||''}</div><div class="rs-d">${now}</div></div>
  </div></div>`;

  h += `<div class="rpt-ft">Optimum Rope Access Solutions ‚Äî Confidential ‚Äî ${fn} ‚Äî ${now}</div>`;
  h += `</body></html>`;

  reportHTML = h;
  return { html: h, filename: fn, data: d, now };
}

// ‚îÄ‚îÄ‚îÄ SUBMIT ‚îÄ‚îÄ‚îÄ
let lastPdfBlob = null;

async function submitReport() {
  const report = buildReport();

  // Show preview
  document.getElementById('pb').innerHTML = reportHTML;
  document.getElementById('po').classList.add('on');
  document.body.style.overflow = 'hidden';
  document.title = report.filename;

  toast('‚è≥ Generating PDF...');

  // Show share button if available on this device
  if (navigator.share && navigator.canShare) {
    document.getElementById('shareBtn').style.display = '';
  }

  // Generate PDF
  try {
    lastPdfBlob = await generatePDF(report.html);
    const pdfBase64 = await blobToBase64(lastPdfBlob);

    // Queue for SharePoint with PDF
    queueReport(report, pdfBase64);

    toast('‚úÖ Report ready ‚Äî tap Save PDF or Share to download');
  } catch(e) {
    console.error('PDF error:', e);
    lastPdfBlob = null;
    queueReport(report, null);
    toast('‚ö†Ô∏è PDF generation failed ‚Äî use Print to save', true);
  }
}

async function generatePDF(html) {
  // Use the preview container which is already rendered with styles
  const previewEl = document.getElementById('pb');

  // If preview isn't populated yet, inject and style it
  if (!previewEl.innerHTML.trim()) {
    previewEl.innerHTML = html;
  }

  const opt = {
    margin: [0.3, 0.3, 0.3, 0.3],
    filename: 'report.pdf',
    image: { type: 'jpeg', quality: 0.95 },
    html2canvas: { scale: 2, useCORS: true, logging: false, scrollY: 0 },
    jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' },
    pagebreak: { mode: ['avoid-all', 'css', 'legacy'] }
  };

  const pdfBlob = await html2pdf().set(opt).from(previewEl).outputPdf('blob');
  return pdfBlob;
}

function blobToBase64(blob) {
  return new Promise((resolve, reject) => {
    const reader = new FileReader();
    reader.onload = () => resolve(reader.result.split(',')[1]);
    reader.onerror = reject;
    reader.readAsDataURL(blob);
  });
}

function downloadReport() {
  const fn = getFN() + '.pdf';
  if (lastPdfBlob) {
    // Try direct download first
    const url = URL.createObjectURL(lastPdfBlob);
    const a = document.createElement('a');
    a.href = url;
    a.download = fn;
    a.style.display = 'none';
    document.body.appendChild(a);
    a.click();
    setTimeout(() => {
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }, 1000);
    toast('‚úÖ PDF downloading ‚Äî check your Downloads folder');
  } else {
    // Regenerate
    if (!reportHTML) buildReport();
    toast('‚è≥ Generating PDF...');
    generatePDF(reportHTML).then(blob => {
      lastPdfBlob = blob;
      downloadReport();
    }).catch(() => {
      toast('‚ö†Ô∏è PDF failed ‚Äî use Share or Print instead', true);
    });
  }
}

async function shareReport() {
  const fn = getFN() + '.pdf';
  if (!lastPdfBlob) {
    toast('‚è≥ Generating PDF...');
    try { lastPdfBlob = await generatePDF(reportHTML); }
    catch(e) { toast('‚ö†Ô∏è PDF failed', true); return; }
  }

  const file = new File([lastPdfBlob], fn, { type: 'application/pdf' });

  try {
    if (navigator.canShare && navigator.canShare({ files: [file] })) {
      await navigator.share({
        title: fn,
        files: [file]
      });
      toast('‚úÖ Shared successfully');
    } else {
      // Fallback: open in new tab
      const url = URL.createObjectURL(lastPdfBlob);
      window.open(url, '_blank');
      toast('üìÑ PDF opened ‚Äî long-press to save');
    }
  } catch(e) {
    if (e.name !== 'AbortError') {
      const url = URL.createObjectURL(lastPdfBlob);
      window.open(url, '_blank');
      toast('üìÑ PDF opened ‚Äî long-press to save');
    }
  }
}

function downloadReportHTML() {
  if (!reportHTML) buildReport();
  const fn = getFN();
  const blob = new Blob([reportHTML], {type:'text/html'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = fn + '.html';
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

// ‚îÄ‚îÄ‚îÄ OFFLINE QUEUE ‚îÄ‚îÄ‚îÄ
function queueReport(report, pdfBase64) {
  try {
    const queue = JSON.parse(localStorage.getItem('optimum_queue') || '[]');
    queue.push({
      id: Date.now(),
      filename: report.filename,
      content: report.html,
      timestamp: new Date().toISOString(),
      formType: 'DailyFieldReport',
      prepEmail: document.getElementById('prepEmail').value || '',
      ccEmail: document.getElementById('ccEmail').value || ''
    });
    localStorage.setItem('optimum_queue', JSON.stringify(queue));
    updateQueueBar();
    if (navigator.onLine) processQueue();
  } catch(e) {
    console.error('Queue error:', e);
  }
}

function loadQueue() {
  updateQueueBar();
  if (navigator.onLine) processQueue();
}

function updateQueueBar() {
  const queue = JSON.parse(localStorage.getItem('optimum_queue') || '[]');
  const bar = document.getElementById('queueBar');
  if (queue.length === 0) {
    bar.classList.remove('show');
  } else {
    bar.classList.add('show');
    bar.textContent = `üì§ ${queue.length} report${queue.length>1?'s':''} waiting to send to SharePoint`;
    bar.className = 'queue-bar show';
  }
}

async function processQueue() {
  if (WEBHOOK_URL === 'PASTE_YOUR_POWER_AUTOMATE_URL_HERE') {
    // Power Automate not set up yet ‚Äî keep in queue
    return;
  }

  const queue = JSON.parse(localStorage.getItem('optimum_queue') || '[]');
  if (queue.length === 0) return;

  const bar = document.getElementById('queueBar');
  bar.textContent = 'üì§ Sending reports to SharePoint...';
  bar.className = 'queue-bar show sending';

  const remaining = [];

  for (const item of queue) {
    try {
      const resp = await fetch(WEBHOOK_URL, {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          filename: item.filename + '.html',
          content: item.content,
          timestamp: item.timestamp,
          formType: item.formType || 'DailyFieldReport',
          prepEmail: item.prepEmail || '',
          ccEmail: item.ccEmail || ''
        })
      });
      if (!resp.ok) throw new Error('Failed');
      toast(`‚úÖ ${item.filename} sent to SharePoint`);
    } catch(e) {
      remaining.push(item);
    }
  }

  localStorage.setItem('optimum_queue', JSON.stringify(remaining));
  updateQueueBar();

  if (remaining.length > 0) {
    bar.textContent = `‚ö†Ô∏è ${remaining.length} report${remaining.length>1?'s':''} failed ‚Äî will retry when online`;
    bar.className = 'queue-bar show error';
  }
}

// ‚îÄ‚îÄ‚îÄ UI HELPERS ‚îÄ‚îÄ‚îÄ
function toast(msg, err) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.className = err ? 'toast error show' : 'toast show';
  setTimeout(() => t.classList.remove('show'), 4000);
}

function closePrint() {
  document.getElementById('po').classList.remove('on');
  document.body.style.overflow = '';
  document.title = 'Optimum ‚Äî Daily Field Report';
}

function clearForm() {
  if (!confirm('Clear all fields? This cannot be undone.')) return;
  document.querySelectorAll('input[type=text],input[type=number],input[type=email],textarea').forEach(el => {if(el.id!=='ccEmail')el.value=''});
  document.querySelectorAll('select').forEach(el => el.selectedIndex=0);
  document.querySelectorAll('.dd-wrap').forEach(el => el.classList.remove('oth-on'));
  document.querySelectorAll('.oth-tog input[type=checkbox]').forEach(el => el.checked=false);
  document.getElementById('rptDate').valueAsDate = new Date();
  photosBefore=[];photosAfter=[];renderPh('before');renderPh('after');
  clearWeather();reportHTML='';
}

document.addEventListener('keydown', e => {if(e.key==='Escape')closePrint()});
init();
</script>
</body>
</html>
